<!doctype html>
<!--
	Copyright (c) 2000-2016 Liferay, Inc. All rights reserved.

	This library is free software; you can redistribute it and/or modify it under
	the terms of the GNU Lesser General Public License as published by the Free
	Software Foundation; either version 2.1 of the License, or (at your option)
	any later version.

	This library is distributed in the hope that it will be useful, but WITHOUT
	ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
	FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
	details.
-->
<html class="no-js" lang="en">
	<head>
		<meta charset="utf-8"/>
		<title>Markdown to Liferay Forums (BBCode) Converter</title>
		<style>
			.textareasize {
				width: 66%;
				height: 20em;
			}
		</style>
		<script type="text/javascript" src="file:///Users/kylestiemann/Tools/marked-0.3.6/marked.min.js"></script>
		<script type="text/javascript">

			function unescape(text) {
				return text.replace('&lt;', '<')
						.replace('&gt;', '>')
						.replace('&quot;', '"')
						.replace('&#39;', "'")
						.replace('&amp;', '&');
			}

			var liferayForumsBBCodeRenderer = new marked.Renderer();
			var useCodeTag = false;

			liferayForumsBBCodeRenderer.code = function (text, language /* unused */) {

				if (useCodeTag) {
					return '\n[code]' + text + '[/code]';
				} else {
					return '\n[size=4][font=Courier New]' + text + '[/font][/size]\n';
				}
			};

			liferayForumsBBCodeRenderer.blockquote = function (text) {
				return '\n[quote]' + unescape(text) + '[/quote]';
			};

			liferayForumsBBCodeRenderer.heading = function (text, level) {

				if (level === 1) {
					size = 7;
				} else if (level === 2) {
					size = 6;
				} else if (level >= 3) {
					size = 5;
				}

				return '[size=' + size + '][b]' + unescape(text) + '[/b][/size]\n';
			};

			liferayForumsBBCodeRenderer.hr = function () {
				return '\n[center][b]---[/b][/center]\n';
			};

			liferayForumsBBCodeRenderer.list = function (body, ordered) {

				var beginTag = '\n[list';

				if (ordered) {
					beginTag += '=1';
				}

				beginTag += ']\n';

				return beginTag + unescape(body) + '[/list]\n';
			};

			liferayForumsBBCodeRenderer.listitem = function (text) {
				return '[*]' + unescape(text) + '\n';
			};

			liferayForumsBBCodeRenderer.paragraph = function (text) {
				return '\n' + unescape(text) + '\n';
			};

			liferayForumsBBCodeRenderer.strong = function (text) {
				return '[b]' + unescape(text) + '[/b]';
			};

			liferayForumsBBCodeRenderer.em = function (text) {
				return '[i]' + unescape(text) + '[/i]';
			};

			liferayForumsBBCodeRenderer.codespan = function (text) {
				return '[font=Courier New]' + unescape(text) + '[/font]';
			};

			liferayForumsBBCodeRenderer.br = function () {
				return '\n';
			};

			liferayForumsBBCodeRenderer.del = function (text) {
				return '[s]' + unescape(text) + '[/s]';
			};

			liferayForumsBBCodeRenderer.link = function (href, title, text) {

				var endTag = '[/url]';

				if (title && title !== '') {
					endTag += ' (' + title + ')';
				}

				return '[url=' + href + ']' + unescape(text) + endTag;
			};

			liferayForumsBBCodeRenderer.image = function (href, title, text) {

				var beginTag = '';

				if (title && title !== '') {
					beginTag += '[size=5][b]' + unescape(title) + '[/b][/size]\n';
				}

				if (text && text !== '') {
					beginTag += unescape(text) + '\n';
				}

				beginTag += '[image]';

				return beginTag + href + '[/image]';
			};

			marked.setOptions({
				renderer: liferayForumsBBCodeRenderer,
				gfm: true,
				tables: true,
				breaks: true,
				pedantic: false,
				sanitize: false,
				smartLists: true,
				smartypants: false
			});

			function convert() {

				var markdown = document.getElementById("markdown_text");
				var bbcode = document.getElementById("bbcode_text");

				var markdown_value = markdown.value;
				//general Markdown conversion
				markdown_value = marked(markdown_value);

				if (markdown_value.charAt(0) === '\n') {
					markdown_value = markdown_value.substr(1);
				}

				bbcode.value = markdown_value;
				console.log('converted');
			}
		</script>
	</head>
	<body>
		<div class="row">
			<h2>Markdown to Liferay Forums (BBCode) Converter</h2>
		</div>

		<div class="row">
			<p>
				Paste your Markdown formatted text into the top box and Liferay forums BBCode appears in the bottom. Indented code will have the space/tabs stripped. You have to manually apply <kbd>[code][/code]</kbd> tags to these. Github style <kbd>```</kbd> code tags or <kbd>~~~</kbd> will be replaced with <kbd>[size=4][font=Courier New]some code[/font][/size]</kbd> tags instead.
			</p>
			<textarea id="markdown_text" class="textareasize" onChange="convert()" onKeyUp="convert()" placeholder="Enter your Markdown formatted text here" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Enter your Markdown formatted text here'"></textarea>
			<textarea id="bbcode_text" class="textareasize" placeholder="Your BBCode formatted text will be automatically shown in this box" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Your BBCode formatted text will be automatically shown in this box'"></textarea>
		</div>
		<script type="text/javascript">
			var textBoxr = document.getElementById("bbcode_text");
			textBoxr.onfocus = function () {
				textBoxr.select();

				textBoxr.onmouseup = function () {
					textBoxr.onmouseup = null;
					return false;
				};
			};
		</script>
	</body>
</html>
